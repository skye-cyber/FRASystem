{% extends 'index.html' %}
<!DOCTYPE html>
<html>
<head>
    <title>Face Recognition Attendance System</title>
    {% load static %}
    {% block styles %}
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">
    <link href="{% static 'css/profile.css' %}" rel="stylesheet">
    {% endblock %}
</head>
{% block bodystart %}
{% with bg_image='images/bg3.png' %}
<body style="background-image: url('{% static bg_image %}');" class="font-sans leading-normal tracking-normal">
  {% endwith %}
  {% endblock %}
    <nav class="block items-center justify-between flex-wrap bg-blue-800 p-6">
      <div class="relative flex">
        <button id="dropdown-button" class="font-bold bg-blue-500 rounded-lg px-4 py-0" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="toggleDropdown()">
            Menu
          </button>

          <!--<svg class="fill-current h-8 w-8 mr-2" width="54" height="54" viewBox="0 0 54 54" xmlns="http://www.w3.org/2000/svg"><path d="M13.5 22.1l-1.4-1.4 4.8-4.8-1.4-1.4-1.4 1.4 4.8 4.8zm-3.2-3.2l1.4-1.4 4.8 4.8-1.4 1.4 1.4-1.4-4.8-4.8zm13.7 5.4l-1.4-1.4-4.8 4.8 1.4 1.4-1.4 1.4 4.8-4.8zm-3.2-3.2l1.4-1.4-4.8 4.8 1.4 1.4 1.4-1.4 4.8-4.8z"/></svg>-->
          {% block navbar %}
          <ul style="display: none;" class="w-fit dropdown-menu flex items-center text-gray-200 hover:text-white dropdown-container absolute left-0 mt-2 w-48 bg-white rounded-lg overflow-hidden shadow-md" id="dropdown-menu">
            <li class="px-4 py-2 border-b border-gray-200"><a href="{% url 'clock_in' %}" class="menu-hover text-gray-600 hover:text-gray-900">Clock In</a></li>
            <li class="px-4 py-2 border-b border-gray-200"><a href="{% url 'deleteAccount' %}" class="menu-hover text-gray-600 hover:text-gray-900">Delete account</a></li>
            <li class="px-4 py-2 border-b border-gray-200"><a href="{% url 'unenroll' %}" class="menu-hover text-gray-600 hover:text-gray-900">Delete FRA Enrollment</a></li>
            <li class="px-4 py-2 border-b border-gray-200"><a href="{% url 'logout' %}" class="menu-hover text-gray-600 hover:text-gray-900">Logout</a></li>
            <li class="px-4 py-2 border-b border-gray-200"><a href="{% url 'home' %}" class="text-gray-600 hover:text-gray-900 bt-hover">üè†Home</a></li>
          </ul>
          {% endblock %}

  {% block content %}

  {% if messages %}
  {% for message in messages %}
  <div id="message" class="alert text-green alert-danger text-center text-sm">{{ message }}</div>
  {% endfor %}
  {% endif %}

    <section class="container mx-auto px-6 py-2">
      <h1 class="text-5xl text-center text-white text-bold mb-12">User Profile</h1>
      <div class="flex flex-wrap">
        <div class="w-full md:w-1/3 p-6 flex flex-col flex-grow flex-shrink">
          <div class="flex-1 bg-white text-gray-600 rounded-t rounded-b-none overflow-hidden shadow">
            <div class="p-8 text-3xl font-bold text-center border-b-4">Profile Photo {{user.photo1}}</div>
            <img class="rounded ml-4" src="{% static 'images/placeholder0.png' %}" alt="Profile photo" class="w-full object-cover h-64 mx-auto mt-6 mb-6">
            <div class="p-8 text-center border-b-4">
              <p class="text-xl">-</p>
            </div>
          </div>
        </div>
        <div class="w-full md:w-2/3 p-6 flex flex-col flex-grow flex-shrink">
          <div class="flex-1 bg-white text-gray-600 rounded-t rounded-b-none overflow-hidden shadow">
            <div class="p-16 text-3xl font-bold text-center border-b-4">User Details</div>
            <div class="p-8">
              <p class="text-xl"><strong>Username:</strong> {{user}}</p>
              <p class="text-xl"><strong>Full Name:</strong> {{user.first_name}} {{user.last_name}}</p>
              <p class="text-xl"><strong>Email:</strong> {{user.email}}</p>
              <p class="text-xl"><strong>Status:</strong> <i class="text-green">{{user.status}}</i></p>
              <p class="text-xl"><strong>SignUp Date:</strong> {{user.date_joined}}</p>
              <!--<p class="text-xl"><strong>Location/Address:</strong> {{user.Address}}</p>-->
            </div>
          </div>
          <div class="flex-1 bg-white text-gray-600 rounded-b-none overflow-hidden shadow">
            <div class="p-8 mt-8 text-3xl font-bold text-center border-b-4">Attendance Reports</div>
            <div class="p-8">
                <p class="text-xl">Clock-in Records:</p>
                <ul>
                    {% for record in clock_in_data %}
                    <li>{{ record.name }} clocked in at {{ record.clock_in_time }}</li>
                    {% endfor %}
                </ul>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script>
  async function DeleteAccount(){
    if (confirm("Are you sure you want to delete your account??")) {
    var reason = prompt("Please enter the reason for deleting your account:", "");

    //if (reason !== null || reason == '') {
        // User provided a reason
        console.log("Reason for deletion:", reason);

        // Proceed with deletion, e.g., make an AJAX request to the server
        fetch('/deleteAccount/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken') // Assuming you have a CSRF token function
            },
            body: JSON.stringify({ reason: reason })
        })

        const data = await response.json();

        if (data.status === 'error') {
        document.getElementById('message').innerText = data.message;
    }


    if (data.status === 'success') {
        document.getElementById('message').innerText = `Account for ${data.employee} deleted successfully`;
        alert(`Dear ${data.employee} Your account has been deleted.`);
        window.location.href = '/'; // Redirect to home or any other page
    }
    else{
      document.getElementById('message').innerText = data.message;
      alert("There was an error deleting your account: " + data.message);
    }

    } else {
        // User canceled the reason input
        console.log("User canceled the reason input.");
    }
}// else {
    // User canceled the deletion confirmation
   // console.log("User canceled deletion.");
//}
//};

// Function to get the CSRF token from cookies (Django-specific)
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
    </script>
  </body>
  {% endblock %}
</html>
